# MultilocusIsland.jl

This julia package implements:

1. Individual-based simulations of a multilocus, biallelic, mainland-island
   population genetics model for a haplodiplontic/haploid/diploid life cycle.
2. Numerical tools to calculate effective migration rates and approximate
   allele frequency distributions in the above model using diffusion theory.

To install the package:

1. Install `julia` from [https://julialang.org/](https://julialang.org/).
2. Open up a terminal and start a REPL by entering `julia` in the prompt.
3. Type `]` to enter the julia package manager.
4. Type `add https://github.com/arzwa/MultilocusIsland` to install the package.

After executing these steps, one should be able to load the package using
`using MultilocusIsland` in the julia REPL.

## Example

````julia
using MultilocusIsland, Distributions, Random; Random.seed!(12)
````

````
TaskLocalRNG()
````

This defines a genetic architecture with `L` biallelic loci with
mean selection coefficient `s̄`, dominance coefficients distributed
according to a Beta(2,2) distribution, and relative strength of haploid vs.
diploid selection drawn from a uniform distribution:

````julia
function random_locus(s̄)
    s = rand(Exponential(s̄))
    h = rand(Beta(2,2))
    t = rand()
    return HapDipLocus(-s*(1-t), -s*h*t, -s*t)
end

L = 50
s̄ = 0.02
A = Architecture([random_locus(s̄) for i=1:L])
````

````
Architecture[L=50 loci]
````

This defines a mainland-island model with `N` haploid individuals per
generation, `N*k` diploid individuals per generation, mutation rate
`u`, genetic architecture `A`, haploid migration rate `m1`,
diploid migration rate `m2` and mainland allele frequencies `y`

````julia
N  = 500
k  = 5
u  = s̄*0.002
m1 = s̄*0.4
m2 = 0.0
y  = ones(L)
M  = MainlandIslandModel(HapDipDeme(N=N, k=k, u=u, A=A), m1, m2, y)
````

````
MainlandIslandModel{HapDipDeme{Architecture{Float64, Float64}, Float64}, MultilocusIsland.FixedMainland{Vector{Float64}, Int64}}(HapDipDeme{Architecture{Float64, Float64}, Float64}
  N: Int64 500
  k: Int64 5
  Ne: Float64 454.5454545454545
  u: Float64 4.0e-5
  A: Architecture{Float64, Float64}
, 0.008, 0.0, MultilocusIsland.FixedMainland{Vector{Float64}, Int64}([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0], [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]))
````

Obtain the equilibrium allele frequencies and heterozygosities

````julia
P, _ = fixedpointit(M, ones(L))
P
````

````
10×50×2 Array{Float64, 3}:
[:, :, 1] =
 1.0       1.0        1.0       1.0       1.0       1.0       1.0       1.0        1.0        1.0       1.0       1.0       1.0       1.0       1.0        1.0       1.0       1.0       1.0       1.0        1.0       1.0       1.0       1.0       1.0       1.0       1.0       1.0       1.0       1.0       1.0       1.0        1.0       1.0       1.0       1.0        1.0        1.0        1.0       1.0       1.0        1.0       1.0        1.0       1.0       1.0       1.0       1.0        1.0       1.0
 0.668573  0.0443625  0.213194  0.806875  0.922646  0.880458  0.960499  0.0240608  0.0741802  0.591531  0.960273  0.765202  0.928826  0.915975  0.0306788  0.862713  0.891627  0.778308  0.184286  0.094865   0.924988  0.946289  0.967901  0.729567  0.852557  0.840636  0.437537  0.956164  0.970758  0.64103   0.889377  0.123454   0.888559  0.235453  0.524165  0.0302279  0.047068   0.0541446  0.927007  0.867983  0.0743718  0.926968  0.0278838  0.919442  0.202138  0.932091  0.215941  0.029108   0.965426  0.856344
 0.557942  0.0330604  0.140993  0.744277  0.903875  0.850172  0.950499  0.0193205  0.052133   0.463922  0.950433  0.686262  0.911195  0.894686  0.0240059  0.824921  0.860355  0.681169  0.126943  0.0663165  0.906247  0.932507  0.960025  0.622779  0.808156  0.792815  0.311963  0.945342  0.963504  0.542217  0.8608    0.08524    0.860859  0.165604  0.397746  0.0236339  0.0349657  0.0397131  0.908785  0.818914  0.0530119  0.909874  0.0219541  0.895397  0.128622  0.91519   0.145728  0.0228474  0.956908  0.81824
 0.532067  0.0310753  0.128343  0.728311  0.899447  0.842908  0.948147  0.018458   0.0483317  0.436022  0.948113  0.666451  0.907031  0.889637  0.0228077  0.815573  0.852547  0.656354  0.116799  0.0613735  0.901816  0.929254  0.958165  0.596656  0.796886  0.780696  0.28743   0.942789  0.961795  0.519335  0.85393   0.078601   0.854269  0.152919  0.371343  0.0224506  0.0328414  0.0371901  0.904478  0.805747  0.0493044  0.905846  0.0208867  0.889324  0.115995  0.911198  0.133302  0.0217219  0.954898  0.808901
 0.525946  0.0306333  0.125537  0.72445   0.898394  0.841172  0.947586  0.0182638  0.0474911  0.429508  0.947561  0.661685  0.90604   0.888433  0.0225389  0.813322  0.850659  0.650364  0.114543  0.0602788  0.900761  0.928478  0.957723  0.590411  0.794156  0.777764  0.281832  0.942181  0.961389  0.513939  0.852287  0.07713    0.852698  0.150079  0.365239  0.0221853  0.0323684  0.036629   0.903452  0.802516  0.0484822  0.90489   0.0206472  0.887847  0.11321   0.910248  0.130539  0.0214694  0.95442   0.806658
 0.524487  0.0305295  0.124879  0.723524  0.898143  0.840758  0.947452  0.018218   0.0472939  0.427961  0.947429  0.660544  0.905803  0.888146  0.0224756  0.812783  0.850207  0.648929  0.114012  0.0600218  0.900509  0.928293  0.957617  0.588919  0.793502  0.777061  0.28051   0.942036  0.961292  0.512654  0.851895  0.0767848  0.852323  0.149411  0.363792  0.0221228  0.0322573  0.0364972  0.903207  0.801739  0.0482892  0.904662  0.0205908  0.887493  0.112557  0.910021  0.12989   0.02141    0.954306  0.806121
 0.524138  0.0305047  0.124722  0.723303  0.898083  0.840659  0.94742   0.0182071  0.047247   0.427592  0.947397  0.660272  0.905747  0.888077  0.0224605  0.812654  0.850098  0.648586  0.113886  0.0599607  0.900449  0.928248  0.957592  0.588562  0.793345  0.776893  0.280195  0.942002  0.961269  0.512347  0.851801  0.0767026  0.852233  0.149252  0.363447  0.022108   0.0322308  0.0364659  0.903149  0.801553  0.0482432  0.904607  0.0205774  0.887408  0.112402  0.909967  0.129735  0.0213958  0.954278  0.805993
 0.524055  0.0304988  0.124685  0.72325   0.898068  0.840635  0.947413  0.0182045  0.0472358  0.427504  0.94739   0.660207  0.905733  0.888061  0.0224569  0.812623  0.850073  0.648504  0.113856  0.0599461  0.900435  0.928238  0.957586  0.588477  0.793308  0.776853  0.280119  0.941993  0.961263  0.512274  0.851778  0.076683   0.852211  0.149214  0.363365  0.0221044  0.0322245  0.0364584  0.903135  0.801509  0.0482323  0.904594  0.0205741  0.887388  0.112365  0.909954  0.129698  0.0213924  0.954272  0.805962
 0.524035  0.0304974  0.124676  0.723237  0.898065  0.840629  0.947411  0.0182039  0.0472331  0.427483  0.947388  0.660191  0.90573   0.888057  0.0224561  0.812616  0.850066  0.648485  0.113849  0.0599426  0.900431  0.928235  0.957585  0.588457  0.793299  0.776843  0.280101  0.941991  0.961262  0.512256  0.851773  0.0766783  0.852206  0.149205  0.363345  0.0221036  0.032223   0.0364566  0.903131  0.801498  0.0482297  0.904591  0.0205734  0.887383  0.112356  0.909951  0.12969   0.0213916  0.95427   0.805955
 0.52403   0.0304971  0.124674  0.723234  0.898064  0.840628  0.947411  0.0182037  0.0472325  0.427478  0.947387  0.660187  0.905729  0.888056  0.0224559  0.812614  0.850065  0.64848   0.113847  0.0599418  0.90043   0.928235  0.957584  0.588452  0.793297  0.776841  0.280097  0.941991  0.961262  0.512252  0.851772  0.0766772  0.852205  0.149202  0.363341  0.0221034  0.0322226  0.0364562  0.903131  0.801496  0.048229   0.904591  0.0205732  0.887382  0.112354  0.90995   0.129687  0.0213914  0.95427   0.805953

[:, :, 2] =
 0.124756  0.0214904  0.0590351  0.118828  0.0671303  0.0947839  0.036756   0.0141955  0.0299764  0.115301  0.0369327  0.125009  0.0624349  0.071788   0.016925   0.102861  0.0861792  0.107112  0.0598212  0.0366931  0.0652923  0.0486556  0.0302359  0.115565  0.105392  0.110504  0.0954083  0.0404495  0.0277017  0.138093  0.0891851  0.0443569  0.0901662  0.0741879  0.111541  0.0166582  0.0225449  0.0249227  0.0637855  0.092624   0.0310762  0.0639844  0.0156625  0.0679041  0.0512065  0.0599294  0.0629175  0.0162082  0.032433   0.106841
 0.125034  0.0213839  0.0587158  0.119412  0.0675902  0.0953643  0.0369462  0.0141404  0.029806   0.115372  0.0371707  0.125537  0.0628337  0.0722132  0.0168525  0.103451  0.0866285  0.107485  0.0594901  0.0364811  0.0656952  0.0489047  0.0304525  0.115912  0.10596   0.1111    0.0952017  0.0407172  0.0278752  0.13838   0.0897131  0.0440982  0.0907316  0.0738137  0.111475  0.0165868  0.0224317  0.0247929  0.0641803  0.0930483  0.0309027  0.0644901  0.0155973  0.068199   0.0509141  0.0603051  0.0625831  0.0161398  0.032654   0.107473
 0.128841  0.0180776  0.0477264  0.136762  0.0822126  0.114446   0.0457904  0.0123785  0.0245525  0.112222  0.0458873  0.139277  0.0768214  0.088164   0.0145589  0.123191  0.105214   0.119061  0.048829   0.0299177  0.0803195  0.0604777  0.0376108  0.124068  0.125455  0.130442  0.0842747  0.050177   0.0345238  0.141351  0.108332   0.0360106  0.109202   0.0615844  0.10426   0.0143332  0.0189201  0.0207767  0.0785124  0.111242   0.0255512  0.0781168  0.0135326  0.0842147  0.0407166  0.0738628  0.0512689  0.0139752  0.0403319  0.127332
 0.128233  0.0174144  0.0453412  0.139894  0.0855605  0.118683   0.0478407  0.0120221  0.0234949  0.110179  0.0479144  0.141254  0.0800336  0.0918038  0.0140973  0.127434  0.10933    0.120333  0.0465557  0.0285874  0.0836717  0.0631513  0.0392834  0.124439  0.129501  0.134368  0.0811643  0.0523747  0.036074   0.140668  0.112495   0.0343496  0.113339   0.0588696  0.101563  0.0138794  0.018216   0.0199715  0.0818008  0.114903   0.0244743  0.081246   0.0131161  0.0878381  0.0385334  0.0769808  0.0488026  0.013539   0.0421224  0.13159
 0.128014  0.0172627  0.0447896  0.140582  0.0863508  0.119676   0.0483275  0.0119402  0.0232537  0.109636  0.0483952  0.141653  0.0807929  0.0926633  0.0139914  0.128419  0.110293   0.120556  0.0460312  0.0282835  0.084464   0.0637856  0.0396803  0.124447  0.130429  0.135263  0.0804072  0.0528957  0.0364421  0.140438  0.113473   0.0339692  0.11431    0.0582378  0.100882  0.0137753  0.018055   0.0197875  0.0825783  0.115734   0.0242283  0.0819841  0.0130205  0.0886921  0.0380303  0.0777184  0.0482314  0.0134389  0.0425472  0.132577
 0.127958  0.0172269  0.0446589  0.140743  0.0865391  0.119912   0.0484436  0.0119208  0.0231967  0.109503  0.0485099  0.141745  0.0809739  0.0928681  0.0139663  0.128652  0.110522   0.120605  0.0459069  0.0282116  0.0846529  0.0639369  0.0397749  0.124445  0.130648  0.135474  0.0802258  0.05302    0.0365299  0.140379  0.113705   0.0338792  0.114541   0.0580879  0.100717  0.0137507  0.0180169  0.019744   0.0827636  0.11593    0.0241702  0.08216    0.0129979  0.0888955  0.0379112  0.0778942  0.048096   0.0134152  0.0426485  0.132811
 0.127945  0.0172184  0.0446277  0.140781  0.086584   0.119968   0.0484713  0.0119161  0.0231831  0.109471  0.0485373  0.141766  0.0810172  0.092917   0.0139604  0.128708  0.110577   0.120616  0.0458773  0.0281945  0.084698   0.063973   0.0397975  0.124444  0.1307    0.135524  0.0801824  0.0530497  0.0365508  0.140365  0.113761   0.0338578  0.114597   0.0580521  0.100677  0.0137448  0.0180079  0.0197336  0.0828078  0.115977   0.0241563  0.082202   0.0129925  0.088944   0.0378828  0.0779361  0.0480637  0.0134096  0.0426727  0.132867
 0.127941  0.0172163  0.0446203  0.14079   0.0865948  0.119981   0.048478   0.011915   0.0231798  0.109464  0.0485438  0.141771  0.0810275  0.0929287  0.0139589  0.128721  0.11059    0.120619  0.0458702  0.0281904  0.0847087  0.0639816  0.0398029  0.124444  0.130713  0.135536  0.080172   0.0530568  0.0365558  0.140362  0.113774   0.0338527  0.11461    0.0580436  0.100668  0.0137434  0.0180057  0.0197311  0.0828184  0.115988   0.024153   0.082212   0.0129912  0.0889556  0.037876   0.0779462  0.048056   0.0134082  0.0426785  0.13288
 0.127941  0.0172158  0.0446185  0.140792  0.0865974  0.119985   0.0484796  0.0119148  0.0231791  0.109462  0.0485454  0.141773  0.0810299  0.0929315  0.0139586  0.128724  0.110593   0.120619  0.0458685  0.0281894  0.0847113  0.0639837  0.0398042  0.124444  0.130716  0.135539  0.0801696  0.0530585  0.036557   0.140361  0.113777   0.0338514  0.114613   0.0580415  0.100666  0.0137431  0.0180052  0.0197306  0.0828209  0.115991   0.0241522  0.0822144  0.0129909  0.0889584  0.0378744  0.0779486  0.0480542  0.0134079  0.0426799  0.132883
 0.12794   0.0172157  0.0446181  0.140793  0.086598   0.119985   0.0484799  0.0119147  0.0231789  0.109461  0.0485458  0.141773  0.0810305  0.0929322  0.0139585  0.128725  0.110594   0.12062   0.0458681  0.0281892  0.0847119  0.0639842  0.0398045  0.124444  0.130717  0.13554   0.080169   0.0530589  0.0365573  0.140361  0.113778   0.0338511  0.114614   0.058041   0.100665  0.013743   0.0180051  0.0197304  0.0828215  0.115991   0.0241521  0.082215   0.0129908  0.0889591  0.037874   0.0779491  0.0480537  0.0134078  0.0426802  0.132884
````

The second argument to `fixedpointit` is the initial value (locally
beneficial allele frequencies on the island) for the fixed-point iteration
algorithm, we use `[1,1,...,1]`, assuming this corresponds to the approach to
equilibrium starting from secondary contact.
**Note:** when dealing with homogeneous architectures (i.e. some proportion
of loci in `A` have identical effects), then the length of the initial vector
should be the number of *unique* loci in the barrier.

`P` is a 3D array, `P[:,:,1]` gives the result of the fixed point iteration
for the allele frequencies, `P[:,:,2]` for the heterozygosities. The columns
correspond to the different loci, the rows correspond to different iterates
of the algorithm. The equilibrium allele frequencies hence are:

````julia
p = P[end,:,1]
````

````
50-element Vector{Float64}:
 0.5240304778337977
 0.03049708925206231
 0.12467356893816303
 0.7232344632480082
 0.898064170540556
 0.8406280027832561
 0.9474105349204728
 0.01820373670672068
 0.047232461354797056
 0.42747760222998005
 0.9473874489770812
 0.660187348814919
 0.9057290789397879
 0.8880559245323839
 0.022455854944073872
 0.8126141078070058
 0.8500649434374787
 0.6484801357960931
 0.11384718642833186
 0.0599418004359558
 0.9004304559793027
 0.9282346587987584
 0.9575842645088743
 0.5884520688007014
 0.793296856005763
 0.7768407807548448
 0.2800971445652775
 0.9419909971318403
 0.961261540921388
 0.5122522766677704
 0.8517716096910977
 0.07667718394751336
 0.8522051001628905
 0.14920247345431983
 0.36334068933536484
 0.022103372799650096
 0.0322226316407962
 0.03645616032648297
 0.9031305954002717
 0.8014958074066219
 0.04822902911143713
 0.9045905965783497
 0.02057320016440807
 0.8873821019626112
 0.11235366151862136
 0.9099498174487549
 0.12968746382769944
 0.021391443076670024
 0.9542699871208541
 0.8059530835602806
````

and the heterozygosities

````julia
pq = P[end,:,2]
````

````
50-element Vector{Float64}:
 0.12794031739272593
 0.01721571048579376
 0.04461805364999865
 0.14079287130083443
 0.08659796602394272
 0.11998544284330005
 0.04847993161186201
 0.01191469892602322
 0.023178865232233316
 0.10946147402660901
 0.048545771846405975
 0.1417729484294688
 0.08103053465094912
 0.09293216023200684
 0.01395851377486483
 0.12872509656713357
 0.11059373372885421
 0.12061961382297491
 0.04586811126212331
 0.028189208287119065
 0.0847119160870802
 0.06398417486231939
 0.03980454579983868
 0.12444376538813874
 0.13071659904545224
 0.13554002373181318
 0.08016896408510829
 0.05305886577605392
 0.036557332803802564
 0.14036082585120743
 0.113777988298708
 0.03385114432032585
 0.11461365895892002
 0.058041034494765435
 0.10066519016203955
 0.013743018541282891
 0.018005063451623986
 0.019730415448787886
 0.08282151757052057
 0.11599125931898574
 0.024152054019659322
 0.08221496418353728
 0.012990842577991192
 0.08895905329136612
 0.037874017151347035
 0.07794913521693367
 0.04805372155207346
 0.013407817663600653
 0.042680214900262574
 0.13288391675855357
````

We can conduct an individual-based simulation for the same model

````julia
genomes, Q = simulate(M, 10000, zeros(L));
````

````
[Running simulation] 100%|███████████████████████████████| Time: 0:00:26

````

Note that this returns the frequency of the locally deleterious alleles
(`q`), not locally beneficial as in the above. We can compare the simulations
against the numerics:

````julia
p_ibm = 1 .- vec(mean(Q[5000:5:end,:], dims=1))
collect(zip(p_ibm, p))
````

````
50-element Vector{Tuple{Float64, Float64}}:
 (0.7148011988011989, 0.5240304778337977)
 (0.016839160839160816, 0.03049708925206231)
 (0.006087912087912373, 0.12467356893816303)
 (0.7945854145854145, 0.7232344632480082)
 (0.882, 0.898064170540556)
 (0.8257702297702297, 0.8406280027832561)
 (0.9466113886113886, 0.9474105349204728)
 (0.021380619380619414, 0.01820373670672068)
 (0.002033966033966106, 0.047232461354797056)
 (0.49981818181818183, 0.42747760222998005)
 (0.9415764235764236, 0.9473874489770812)
 (0.593000999000999, 0.660187348814919)
 (0.9051448551448552, 0.9057290789397879)
 (0.8900139860139861, 0.8880559245323839)
 (0.006747252747252852, 0.022455854944073872)
 (0.8015204795204796, 0.8126141078070058)
 (0.8741478521478522, 0.8500649434374787)
 (0.7865934065934066, 0.6484801357960931)
 (0.4409530469530468, 0.11384718642833186)
 (0.32310889110889096, 0.0599418004359558)
 (0.8838941058941059, 0.9004304559793027)
 (0.9332927072927073, 0.9282346587987584)
 (0.9532647352647353, 0.9575842645088743)
 (0.3791888111888113, 0.5884520688007014)
 (0.7494265734265735, 0.793296856005763)
 (0.8057642357642358, 0.7768407807548448)
 (0.0011168831168831828, 0.2800971445652775)
 (0.9377862137862139, 0.9419909971318403)
 (0.9609430569430569, 0.961261540921388)
 (0.5788351648351648, 0.5122522766677704)
 (0.8073906093906094, 0.8517716096910977)
 (0.12433566433566434, 0.07667718394751336)
 (0.806995004995005, 0.8522051001628905)
 (0.022793206793206844, 0.14920247345431983)
 (0.46468331668331664, 0.36334068933536484)
 (0.10763236763236761, 0.022103372799650096)
 (0.0026073926073927334, 0.0322226316407962)
 (0.00858941058941054, 0.03645616032648297)
 (0.9123996003996004, 0.9031305954002717)
 (0.8736023976023977, 0.8014958074066219)
 (0.1376183816183817, 0.04822902911143713)
 (0.9029890109890111, 0.9045905965783497)
 (0.008801198801198895, 0.02057320016440807)
 (0.8878421578421579, 0.8873821019626112)
 (0.001910089910089896, 0.11235366151862136)
 (0.9028651348651349, 0.9099498174487549)
 (0.6128731268731269, 0.12968746382769944)
 (0.0046473526473528315, 0.021391443076670024)
 (0.9501698301698301, 0.9542699871208541)
 (0.8206233766233766, 0.8059530835602806)
````

Of course, one should do more/longer simulations.

---

*This page was generated using [Literate.jl](https://github.com/fredrikekre/Literate.jl).*

